<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>技術者登録・編集 - SES業務システム</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    
    <!-- カスタムCSS -->
    <style>
        :root {
            --sidebar-width: 280px;
            --header-height: 60px;
            --ses-primary: #0d6efd;
            --ses-secondary: #6c757d;
            --ses-success: #198754;
            --ses-warning: #ffc107;
            --ses-danger: #dc3545;
            --ses-light: #f8f9fa;
        }
        
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
        }
        
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background-color: #212529;
            z-index: 1000;
        }
        
        .navbar {
            height: var(--header-height);
            background-color: #ffffff !important;
            border-bottom: 1px solid #dee2e6;
        }
        
        .step-wizard {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }
        
        .step {
            display: flex;
            align-items: center;
            position: relative;
            margin: 0 1rem;
        }
        
        .step-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        .step.active .step-indicator {
            background: var(--ses-primary);
            color: white;
        }
        
        .step.completed .step-indicator {
            background: var(--ses-success);
            color: white;
        }
        
        .step-label {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .step.active .step-label {
            color: var(--ses-primary);
            font-weight: 500;
        }
        
        .step.completed .step-label {
            color: var(--ses-success);
        }
        
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 40px;
            width: 60px;
            height: 2px;
            background: #e9ecef;
            z-index: 1;
        }
        
        .step.completed:not(:last-child)::after {
            background: var(--ses-success);
        }
        
        .skill-input-group {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #f8f9fa;
        }
        
        .skill-tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            min-height: 38px;
            padding: 0.375rem 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            background: white;
        }
        
        .skill-tag {
            display: inline-flex;
            align-items: center;
            background: var(--ses-primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
        
        .skill-tag .remove-btn {
            margin-left: 0.5rem;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
        }
        
        .skill-level-slider {
            width: 100%;
            margin: 0.5rem 0;
        }
        
        .preview-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-step {
            display: none;
        }
        
        .form-step.active {
            display: block;
        }
        
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 0.375rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: var(--ses-primary);
            background: rgba(13, 110, 253, 0.05);
        }
        
        .upload-area.drag-over {
            border-color: var(--ses-primary);
            background: rgba(13, 110, 253, 0.1);
        }
        
        .certification-item {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: white;
        }
    </style>
</head>
<body x-data="engineerForm" x-cloak>
    
    <!-- ヘッダー -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container-fluid">
            <button class="btn btn-outline-secondary me-3" @click="toggleSidebar()">
                <i class="bi bi-list"></i>
            </button>
            <a class="navbar-brand" href="#">SES業務システム</a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-1"></i>山田太郎
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>プロフィール</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>設定</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>ログアウト</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- サイドバー -->
    <nav class="sidebar text-white">
        <div class="p-3">
            <ul class="nav nav-pills flex-column">
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-briefcase me-2"></i>案件管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white active" href="#">
                        <i class="bi bi-people me-2"></i>技術者管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-search-heart me-2"></i>マッチング
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-file-earmark-text me-2"></i>契約管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-clock me-2"></i>勤怠管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-receipt me-2"></i>請求管理
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-graph-up me-2"></i>レポート
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    
    <!-- メインコンテンツ -->
    <main class="main-content">
        <div class="container-fluid p-4">
            <!-- ページヘッダー -->
            <div class="d-flex justify-content-between align-items-start mb-4">
                <div>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#" class="text-decoration-none">技術者管理</a></li>
                            <li class="breadcrumb-item active" aria-current="page" x-text="isEditMode ? '技術者編集' : '技術者登録'">技術者登録</li>
                        </ol>
                    </nav>
                    <h1 class="h3 mb-2" x-text="isEditMode ? '技術者情報編集' : '新規技術者登録'">新規技術者登録</h1>
                    <p class="text-muted mb-0">技術者の基本情報、スキル、認証情報を登録してください</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-secondary" @click="saveDraft()" :disabled="currentStep === 4">
                        <i class="bi bi-bookmark me-1"></i>下書き保存
                    </button>
                    <button class="btn btn-outline-danger" @click="cancelForm()">
                        <i class="bi bi-x me-1"></i>キャンセル
                    </button>
                </div>
            </div>
            
            <!-- ステップウィザード -->
            <div class="step-wizard">
                <div class="step" :class="{ active: currentStep === 1, completed: currentStep > 1 }">
                    <div class="step-indicator">
                        <i x-show="currentStep > 1" class="bi bi-check"></i>
                        <span x-show="currentStep <= 1">1</span>
                    </div>
                    <div class="step-label">基本情報</div>
                </div>
                <div class="step" :class="{ active: currentStep === 2, completed: currentStep > 2 }">
                    <div class="step-indicator">
                        <i x-show="currentStep > 2" class="bi bi-check"></i>
                        <span x-show="currentStep <= 2">2</span>
                    </div>
                    <div class="step-label">スキル・経験</div>
                </div>
                <div class="step" :class="{ active: currentStep === 3, completed: currentStep > 3 }">
                    <div class="step-indicator">
                        <i x-show="currentStep > 3" class="bi bi-check"></i>
                        <span x-show="currentStep <= 3">3</span>
                    </div>
                    <div class="step-label">認証・資格</div>
                </div>
                <div class="step" :class="{ active: currentStep === 4, completed: currentStep > 4 }">
                    <div class="step-indicator">4</div>
                    <div class="step-label">確認・完了</div>
                </div>
            </div>
            
            <!-- フォームコンテンツ -->
            <div class="card">
                <form @submit.prevent="submitForm()">
                    <!-- ステップ1: 基本情報 -->
                    <div class="form-step" :class="{ active: currentStep === 1 }">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-person-badge me-2"></i>基本情報入力
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">氏名 <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" x-model="formData.name" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">フリガナ</label>
                                            <input type="text" class="form-control" x-model="formData.nameKana">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">メールアドレス <span class="text-danger">*</span></label>
                                            <input type="email" class="form-control" x-model="formData.email" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">電話番号</label>
                                            <input type="tel" class="form-control" x-model="formData.phone">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">生年月日</label>
                                            <input type="date" class="form-control" x-model="formData.birthDate">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">入社予定日</label>
                                            <input type="date" class="form-control" x-model="formData.joinDate">
                                        </div>
                                        <div class="col-md-12">
                                            <label class="form-label">住所</label>
                                            <input type="text" class="form-control" x-model="formData.address">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">職位 <span class="text-danger">*</span></label>
                                            <select class="form-select" x-model="formData.position" required>
                                                <option value="">選択してください</option>
                                                <option value="JUNIOR">ジュニアエンジニア</option>
                                                <option value="REGULAR">エンジニア</option>
                                                <option value="SENIOR">シニアエンジニア</option>
                                                <option value="LEAD">リードエンジニア</option>
                                                <option value="MANAGER">マネージャー</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">雇用形態 <span class="text-danger">*</span></label>
                                            <select class="form-select" x-model="formData.employmentType" required>
                                                <option value="">選択してください</option>
                                                <option value="FULLTIME">正社員</option>
                                                <option value="CONTRACT">契約社員</option>
                                                <option value="PARTTIME">パートタイム</option>
                                                <option value="FREELANCE">フリーランス</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">緊急連絡先</label>
                                            <input type="text" class="form-control" x-model="formData.emergencyContact">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">緊急連絡先電話番号</label>
                                            <input type="tel" class="form-control" x-model="formData.emergencyPhone">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">プロフィール画像</h6>
                                            <div class="upload-area" 
                                                 @dragover.prevent
                                                 @dragenter.prevent="dragEnter"
                                                 @dragleave.prevent="dragLeave"
                                                 @drop.prevent="dropFile">
                                                <div x-show="!formData.avatar">
                                                    <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                                                    <p class="text-muted">画像をドラッグ&ドロップするか、<br>クリックしてファイルを選択</p>
                                                    <input type="file" class="d-none" accept="image/*" @change="handleFileSelect">
                                                    <button type="button" class="btn btn-outline-primary" @click="$el.previousElementSibling.click()">
                                                        ファイル選択
                                                    </button>
                                                </div>
                                                <div x-show="formData.avatar" class="text-center">
                                                    <img :src="formData.avatar" class="img-thumbnail mb-2" style="max-width: 150px;">
                                                    <br>
                                                    <button type="button" class="btn btn-outline-secondary btn-sm" @click="removeAvatar()">
                                                        削除
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ステップ2: スキル・経験 -->
                    <div class="form-step" :class="{ active: currentStep === 2 }">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-gear me-2"></i>スキル・経験入力
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-8">
                                    <!-- 技術スキル -->
                                    <div class="skill-input-group">
                                        <h6>技術スキル</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">スキル名</label>
                                                <input type="text" class="form-control" x-model="newSkill.name" placeholder="例: Java">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">カテゴリ</label>
                                                <select class="form-select" x-model="newSkill.category">
                                                    <option value="">選択してください</option>
                                                    <option value="PROGRAMMING_LANGUAGE">プログラミング言語</option>
                                                    <option value="FRAMEWORK">フレームワーク</option>
                                                    <option value="DATABASE">データベース</option>
                                                    <option value="CLOUD">クラウド</option>
                                                    <option value="DEVOPS">DevOps</option>
                                                    <option value="FRONTEND">フロントエンド</option>
                                                    <option value="BACKEND">バックエンド</option>
                                                    <option value="MOBILE">モバイル</option>
                                                    <option value="TESTING">テスト</option>
                                                    <option value="PROJECT_MANAGEMENT">プロジェクト管理</option>
                                                    <option value="BUSINESS_SKILL">ビジネススキル</option>
                                                    <option value="OTHER">その他</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">経験年数</label>
                                                <input type="number" class="form-control" x-model="newSkill.experience" min="0" max="30">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">レベル (0-100)</label>
                                                <input type="range" class="skill-level-slider form-range" x-model="newSkill.level" min="0" max="100">
                                                <div class="d-flex justify-content-between small text-muted">
                                                    <span>初心者</span>
                                                    <span x-text="newSkill.level"></span>
                                                    <span>エキスパート</span>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <button type="button" class="btn btn-outline-primary" @click="addSkill()">
                                                    <i class="bi bi-plus me-1"></i>スキル追加
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 追加されたスキル一覧 -->
                                    <div x-show="formData.skills.length > 0">
                                        <h6>登録済みスキル</h6>
                                        <template x-for="(skill, index) in formData.skills" :key="index">
                                            <div class="skill-input-group">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <div>
                                                        <span class="fw-medium" x-text="skill.name"></span>
                                                        <span class="badge bg-light text-dark ms-2" x-text="skill.category"></span>
                                                    </div>
                                                    <button type="button" class="btn btn-outline-danger btn-sm" @click="removeSkill(index)">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                                <div class="row g-2">
                                                    <div class="col-md-6">
                                                        <small class="text-muted">経験年数: <span x-text="skill.experience"></span>年</small>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <small class="text-muted">レベル: <span x-text="skill.level"></span>/100</small>
                                                    </div>
                                                </div>
                                                <div class="progress mt-2" style="height: 6px;">
                                                    <div class="progress-bar" :style="`width: ${skill.level}%`"></div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <div class="col-lg-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">職歴・経験</h6>
                                            <div class="mb-3">
                                                <label class="form-label">総合経験年数</label>
                                                <input type="number" class="form-control" x-model="formData.totalExperience" min="0" max="50">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">前職</label>
                                                <input type="text" class="form-control" x-model="formData.previousCompany">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">希望時間単価</label>
                                                <input type="number" class="form-control" x-model="formData.desiredHourlyRate" min="0">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">稼働可能時間/週</label>
                                                <select class="form-select" x-model="formData.availableHours">
                                                    <option value="">選択してください</option>
                                                    <option value="20">20時間/週</option>
                                                    <option value="30">30時間/週</option>
                                                    <option value="40">40時間/週 (フルタイム)</option>
                                                    <option value="flexible">柔軟対応</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ステップ3: 認証・資格 -->
                    <div class="form-step" :class="{ active: currentStep === 3 }">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-award me-2"></i>認証・資格入力
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-8">
                                    <!-- 資格追加フォーム -->
                                    <div class="skill-input-group">
                                        <h6>新しい資格・認証を追加</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">資格名</label>
                                                <input type="text" class="form-control" x-model="newCertification.name" placeholder="例: AWS Solutions Architect">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">発行機関</label>
                                                <input type="text" class="form-control" x-model="newCertification.issuer" placeholder="例: Amazon Web Services">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">取得日</label>
                                                <input type="date" class="form-control" x-model="newCertification.obtainedDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">有効期限</label>
                                                <input type="date" class="form-control" x-model="newCertification.expiryDate">
                                                <div class="form-check mt-2">
                                                    <input class="form-check-input" type="checkbox" x-model="newCertification.noExpiry">
                                                    <label class="form-check-label">有効期限なし</label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <button type="button" class="btn btn-outline-primary" @click="addCertification()">
                                                    <i class="bi bi-plus me-1"></i>資格追加
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 追加された資格一覧 -->
                                    <div x-show="formData.certifications.length > 0">
                                        <h6>登録済み資格・認証</h6>
                                        <template x-for="(cert, index) in formData.certifications" :key="index">
                                            <div class="certification-item">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <h6 class="mb-1" x-text="cert.name"></h6>
                                                        <div class="text-muted small mb-1" x-text="cert.issuer"></div>
                                                        <div class="text-muted small">
                                                            取得日: <span x-text="cert.obtainedDate"></span>
                                                            <span x-show="!cert.noExpiry">
                                                                | 期限: <span x-text="cert.expiryDate"></span>
                                                            </span>
                                                            <span x-show="cert.noExpiry">| 期限なし</span>
                                                        </div>
                                                    </div>
                                                    <button type="button" class="btn btn-outline-danger btn-sm" @click="removeCertification(index)">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                
                                <div class="col-lg-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">学歴・教育背景</h6>
                                            <div class="mb-3">
                                                <label class="form-label">最終学歴</label>
                                                <select class="form-select" x-model="formData.education">
                                                    <option value="">選択してください</option>
                                                    <option value="高校卒">高校卒</option>
                                                    <option value="専門学校卒">専門学校卒</option>
                                                    <option value="短大卒">短大卒</option>
                                                    <option value="大学卒">大学卒</option>
                                                    <option value="大学院卒">大学院卒</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">学校名</label>
                                                <input type="text" class="form-control" x-model="formData.schoolName">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">専攻・学部</label>
                                                <input type="text" class="form-control" x-model="formData.major">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">卒業年</label>
                                                <input type="number" class="form-control" x-model="formData.graduationYear" min="1950" :max="new Date().getFullYear()">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ステップ4: 確認・完了 -->
                    <div class="form-step" :class="{ active: currentStep === 4 }">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-check-circle me-2"></i>入力内容確認
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- 基本情報プレビュー -->
                            <div class="preview-card">
                                <h6><i class="bi bi-person-badge me-2"></i>基本情報</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <strong>氏名:</strong> <span x-text="formData.name"></span><br>
                                        <strong>メール:</strong> <span x-text="formData.email"></span><br>
                                        <strong>電話:</strong> <span x-text="formData.phone"></span><br>
                                        <strong>職位:</strong> <span x-text="getPositionText(formData.position)"></span><br>
                                        <strong>雇用形態:</strong> <span x-text="getEmploymentText(formData.employmentType)"></span>
                                    </div>
                                    <div class="col-md-6" x-show="formData.avatar">
                                        <img :src="formData.avatar" class="img-thumbnail" style="max-width: 120px;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- スキルプレビュー -->
                            <div class="preview-card" x-show="formData.skills.length > 0">
                                <h6><i class="bi bi-gear me-2"></i>技術スキル</h6>
                                <template x-for="skill in formData.skills" :key="skill.name">
                                    <div class="mb-2">
                                        <span class="fw-medium" x-text="skill.name"></span>
                                        <span class="badge bg-light text-dark ms-2" x-text="skill.category"></span>
                                        <span class="text-muted ms-2">
                                            経験<span x-text="skill.experience"></span>年 / レベル<span x-text="skill.level"></span>
                                        </span>
                                    </div>
                                </template>
                            </div>
                            
                            <!-- 資格プレビュー -->
                            <div class="preview-card" x-show="formData.certifications.length > 0">
                                <h6><i class="bi bi-award me-2"></i>資格・認証</h6>
                                <template x-for="cert in formData.certifications" :key="cert.name">
                                    <div class="mb-2">
                                        <strong x-text="cert.name"></strong> (<span x-text="cert.issuer"></span>)<br>
                                        <small class="text-muted">取得日: <span x-text="cert.obtainedDate"></span></small>
                                    </div>
                                </template>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                入力内容に間違いがないかご確認ください。登録後も編集は可能です。
                            </div>
                        </div>
                    </div>
                    
                    <!-- フォームアクション -->
                    <div class="card-footer">
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary" @click="previousStep()" x-show="currentStep > 1">
                                <i class="bi bi-arrow-left me-1"></i>前へ
                            </button>
                            <div class="ms-auto d-flex gap-2">
                                <button type="button" class="btn btn-primary" @click="nextStep()" x-show="currentStep < 4">
                                    次へ <i class="bi bi-arrow-right ms-1"></i>
                                </button>
                                <button type="submit" class="btn btn-success" x-show="currentStep === 4">
                                    <i class="bi bi-check me-1"></i>登録完了
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
    
    <!-- JavaScript -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('engineerForm', () => ({
                currentStep: 1,
                isEditMode: false,
                
                formData: {
                    name: '',
                    nameKana: '',
                    email: '',
                    phone: '',
                    birthDate: '',
                    joinDate: '',
                    address: '',
                    position: '',
                    employmentType: '',
                    emergencyContact: '',
                    emergencyPhone: '',
                    avatar: '',
                    totalExperience: 0,
                    previousCompany: '',
                    desiredHourlyRate: 0,
                    availableHours: '',
                    education: '',
                    schoolName: '',
                    major: '',
                    graduationYear: '',
                    skills: [],
                    certifications: []
                },
                
                newSkill: {
                    name: '',
                    category: '',
                    experience: 0,
                    level: 50
                },
                
                newCertification: {
                    name: '',
                    issuer: '',
                    obtainedDate: '',
                    expiryDate: '',
                    noExpiry: false
                },
                
                nextStep() {
                    if (this.validateCurrentStep()) {
                        this.currentStep = Math.min(4, this.currentStep + 1);
                    }
                },
                
                previousStep() {
                    this.currentStep = Math.max(1, this.currentStep - 1);
                },
                
                validateCurrentStep() {
                    if (this.currentStep === 1) {
                        return this.formData.name && this.formData.email && this.formData.position && this.formData.employmentType;
                    }
                    return true;
                },
                
                addSkill() {
                    if (this.newSkill.name && this.newSkill.category) {
                        this.formData.skills.push({...this.newSkill});
                        this.newSkill = { name: '', category: '', experience: 0, level: 50 };
                    }
                },
                
                removeSkill(index) {
                    this.formData.skills.splice(index, 1);
                },
                
                addCertification() {
                    if (this.newCertification.name && this.newCertification.issuer) {
                        const cert = {...this.newCertification};
                        if (cert.noExpiry) {
                            cert.expiryDate = '';
                        }
                        this.formData.certifications.push(cert);
                        this.newCertification = { name: '', issuer: '', obtainedDate: '', expiryDate: '', noExpiry: false };
                    }
                },
                
                removeCertification(index) {
                    this.formData.certifications.splice(index, 1);
                },
                
                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.formData.avatar = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },
                
                dropFile(event) {
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                this.formData.avatar = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                },
                
                removeAvatar() {
                    this.formData.avatar = '';
                },
                
                saveDraft() {
                    localStorage.setItem('engineerFormDraft', JSON.stringify(this.formData));
                    alert('下書きを保存しました。');
                },
                
                loadDraft() {
                    const draft = localStorage.getItem('engineerFormDraft');
                    if (draft) {
                        this.formData = JSON.parse(draft);
                    }
                },
                
                cancelForm() {
                    if (confirm('入力内容が失われますが、よろしいですか？')) {
                        window.location.href = '/engineers';
                    }
                },
                
                submitForm() {
                    console.log('登録データ:', this.formData);
                    alert('技術者情報を登録しました。');
                    // 実際の処理: API送信
                },
                
                getPositionText(position) {
                    const positions = {
                        'JUNIOR': 'ジュニアエンジニア',
                        'REGULAR': 'エンジニア',
                        'SENIOR': 'シニアエンジニア',
                        'LEAD': 'リードエンジニア',
                        'MANAGER': 'マネージャー'
                    };
                    return positions[position] || position;
                },
                
                getEmploymentText(type) {
                    const types = {
                        'FULLTIME': '正社員',
                        'CONTRACT': '契約社員',
                        'PARTTIME': 'パートタイム',
                        'FREELANCE': 'フリーランス'
                    };
                    return types[type] || type;
                },
                
                init() {
                    this.loadDraft();
                }
            }));
        });
    </script>
</body>
</html>