<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç´„Çπ„Çø„É†„É¨„Éù„Éº„Éà‰ΩúÊàê - SESÊ•≠Âãô„Ç∑„Çπ„ÉÜ„É†</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    
    <!-- Sortable.js for drag and drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <!-- „Ç´„Çπ„Çø„É†CSS -->
    <style>
        :root {
            --sidebar-width: 280px;
            --header-height: 60px;
            --ses-primary: #0d6efd;
            --ses-secondary: #6c757d;
            --ses-success: #198754;
            --ses-warning: #ffc107;
            --ses-danger: #dc3545;
            --ses-light: #f8f9fa;
            --ses-info: #0dcaf0;
            --ses-dark: #212529;
            --builder-primary: #6f42c1;
            --builder-secondary: #e83e8c;
            --builder-accent: #20c997;
            --section-bg: #f8f9ff;
        }
        
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
            background: #f8f9fa;
        }
        
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background-color: #212529;
            z-index: 1000;
        }
        
        .navbar {
            height: var(--header-height);
            background-color: #ffffff !important;
            border-bottom: 1px solid #dee2e6;
        }
        
        .builder-header {
            background: linear-gradient(135deg, var(--builder-primary), #8b5cf6);
            color: white;
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .builder-header::before {
            content: '';
            position: absolute;
            top: -30%;
            right: -15%;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        
        .builder-layout {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }
        
        .builder-panel {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 0.25rem 1rem rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            overflow: hidden;
        }
        
        .panel-header {
            background: var(--ses-light);
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            font-weight: 600;
            color: var(--ses-dark);
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .panel-body {
            padding: 1.5rem;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }
        
        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--ses-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .component-palette {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
        
        .component-item {
            background: var(--section-bg);
            border: 2px dashed #c8d3ff;
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            cursor: grab;
            transition: all 0.3s;
            user-select: none;
        }
        
        .component-item:hover {
            border-color: var(--builder-primary);
            background: rgba(111, 66, 193, 0.1);
            transform: translateY(-2px);
        }
        
        .component-item:active {
            cursor: grabbing;
        }
        
        .component-icon {
            font-size: 2rem;
            color: var(--builder-primary);
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .component-name {
            font-weight: 500;
            color: var(--ses-dark);
            font-size: 0.9rem;
        }
        
        .canvas-area {
            background: white;
            border-radius: 1rem;
            min-height: 500px;
            padding: 2rem;
            position: relative;
            border: 2px dashed #dee2e6;
        }
        
        .canvas-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: var(--ses-secondary);
            text-align: center;
        }
        
        .canvas-empty i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .report-sections {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .report-section {
            background: var(--section-bg);
            border: 2px solid #e9ecef;
            border-radius: 1rem;
            padding: 1.5rem;
            position: relative;
            transition: all 0.3s;
        }
        
        .report-section:hover {
            border-color: var(--builder-primary);
            box-shadow: 0 0.25rem 1rem rgba(111, 66, 193, 0.1);
        }
        
        .report-section.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .section-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .section-type {
            background: var(--builder-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .section-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .section-content {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            min-height: 100px;
            border: 1px solid #dee2e6;
        }
        
        .chart-preview {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8f9fa 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8f9fa 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .config-panel {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 0.25rem 1rem rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }
        
        .config-tabs {
            display: flex;
            background: var(--ses-light);
            border-radius: 1rem 1rem 0 0;
        }
        
        .config-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--ses-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .config-tab.active {
            background: white;
            color: var(--builder-primary);
            border-bottom: 3px solid var(--builder-primary);
        }
        
        .config-content {
            padding: 1.5rem;
            max-height: calc(100vh - 400px);
            overflow-y: auto;
        }
        
        .preview-container {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }
        
        .preview-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .color-picker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .data-mapping {
            background: var(--ses-light);
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .mapping-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .mapping-row:last-child {
            margin-bottom: 0;
        }
        
        .mapping-label {
            min-width: 80px;
            font-weight: 500;
            color: var(--ses-dark);
        }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .time-picker {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .recipients-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 0.75rem;
            background: white;
        }
        
        .recipient-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
            margin-bottom: 0.25rem;
        }
        
        .recipient-item:hover {
            background: var(--ses-light);
        }
        
        .action-buttons {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 1.5rem;
            border-top: 1px solid #dee2e6;
            margin: -1.5rem -1.5rem 0;
            display: flex;
            gap: 1rem;
        }
        
        .floating-preview {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vw;
            max-width: 1200px;
            height: 90vh;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2rem 4rem rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            overflow: hidden;
        }
        
        .preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }
        
        .sortable-ghost {
            opacity: 0.4;
        }
        
        .sortable-chosen {
            transform: scale(1.05);
        }
        
        .drag-handle {
            cursor: grab;
            color: var(--ses-secondary);
            font-size: 1.2rem;
        }
        
        .drag-handle:hover {
            color: var(--builder-primary);
        }
        
        .success-indicator {
            background: var(--ses-success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .validation-error {
            background: var(--ses-danger);
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        @media (max-width: 1200px) {
            .builder-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
        }
        
        @media (max-width: 768px) {
            .builder-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .panel-body {
                max-height: none;
            }
            
            .config-content {
                max-height: none;
            }
        }
    </style>
</head>
<body x-data="customReportBuilder" x-cloak>
    
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container-fluid">
            <button class="btn btn-outline-secondary me-3" @click="toggleSidebar()">
                <i class="bi bi-list"></i>
            </button>
            <a class="navbar-brand" href="#">SESÊ•≠Âãô„Ç∑„Çπ„ÉÜ„É†</a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-1"></i>ÁÆ°ÁêÜËÄÖ Áî∞‰∏≠
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>„Éó„É≠„Éï„Ç£„Éº„É´</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Ë®≠ÂÆö</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>„É≠„Ç∞„Ç¢„Ç¶„Éà</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
    <nav class="sidebar text-white">
        <div class="p-3">
            <ul class="nav nav-pills flex-column">
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-briefcase me-2"></i>Ê°à‰ª∂ÁÆ°ÁêÜ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-people me-2"></i>ÊäÄË°ìËÄÖÁÆ°ÁêÜ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-search-heart me-2"></i>„Éû„ÉÉ„ÉÅ„É≥„Ç∞
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-file-earmark-text me-2"></i>Â•ëÁ¥ÑÁÆ°ÁêÜ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-clock me-2"></i>Âã§ÊÄ†ÁÆ°ÁêÜ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white-50" href="#">
                        <i class="bi bi-receipt me-2"></i>Ë´ãÊ±ÇÁÆ°ÁêÜ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white active" href="#">
                        <i class="bi bi-graph-up me-2"></i>„É¨„Éù„Éº„Éà
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="main-content">
        <div class="container-fluid p-4">
            
            <!-- „Éì„É´„ÉÄ„Éº„Éò„ÉÉ„ÉÄ„Éº -->
            <div class="builder-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h1 class="h2 mb-2">üé® „Ç´„Çπ„Çø„É†„É¨„Éù„Éº„Éà„Éì„É´„ÉÄ„Éº</h1>
                        <p class="mb-0 opacity-75">„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÁ∞°Âçò„Å´„É¨„Éù„Éº„Éà„Çí‰ΩúÊàê</p>
                    </div>
                    <div class="text-end">
                        <div class="success-indicator" x-show="autoSaved" x-transition>
                            <i class="bi bi-check-circle me-1"></i>Ëá™Âãï‰øùÂ≠òÊ∏à„Åø
                        </div>
                        <div class="small opacity-75 mt-1">
                            ÊúÄÁµÇ‰øùÂ≠ò: <span x-text="lastSaved"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº -->
            <div class="validation-error" x-show="validationErrors.length > 0" x-transition>
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span x-text="validationErrors[0]"></span>
            </div>
            
            <!-- „Éì„É´„ÉÄ„Éº„É¨„Ç§„Ç¢„Ç¶„Éà -->
            <div class="builder-layout">
                
                <!-- Â∑¶„Éë„Éç„É´: Âü∫Êú¨Ë®≠ÂÆö & „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà -->
                <div class="builder-panel">
                    <div class="panel-header">
                        <i class="bi bi-gear me-2"></i>„É¨„Éù„Éº„ÉàË®≠ÂÆö
                    </div>
                    <div class="panel-body">
                        
                        <!-- Âü∫Êú¨ÊÉÖÂ†± -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="bi bi-file-text"></i>Âü∫Êú¨ÊÉÖÂ†±
                            </div>
                            <div class="mb-3">
                                <label class="form-label">„É¨„Éù„Éº„ÉàÂêç</label>
                                <input type="text" class="form-control" x-model="reportConfig.name" 
                                       placeholder="‰æã: ÊúàÊ¨°Â£≤‰∏äÂàÜÊûê„É¨„Éù„Éº„Éà">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Ë™¨Êòé</label>
                                <textarea class="form-control" rows="3" x-model="reportConfig.description"
                                         placeholder="„É¨„Éù„Éº„Éà„ÅÆÁõÆÁöÑ„ÇÑÂÜÖÂÆπ„ÇíË™¨Êòé"></textarea>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="form-label">„Çø„Ç§„Éó</label>
                                    <select class="form-select" x-model="reportConfig.type">
                                        <option value="daily">Êó•Ê¨°</option>
                                        <option value="weekly">ÈÄ±Ê¨°</option>
                                        <option value="monthly">ÊúàÊ¨°</option>
                                        <option value="quarterly">ÂõõÂçäÊúü</option>
                                        <option value="yearly">Âπ¥Ê¨°</option>
                                        <option value="adhoc">„Ç¢„Éâ„Éõ„ÉÉ„ÇØ</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label">„Ç´„ÉÜ„Ç¥„É™</label>
                                    <select class="form-select" x-model="reportConfig.category">
                                        <option value="sales">Â£≤‰∏ä</option>
                                        <option value="financial">Ë≤°Âãô</option>
                                        <option value="operational">ÈÅãÁî®</option>
                                        <option value="hr">‰∫∫‰∫ã</option>
                                        <option value="executive">ÁµåÂñ∂</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- „Éá„Éº„Çø„ÇΩ„Éº„Çπ -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="bi bi-database"></i>„Éá„Éº„Çø„ÇΩ„Éº„Çπ
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ÊúüÈñìË®≠ÂÆö</label>
                                <div class="row">
                                    <div class="col-6">
                                        <input type="date" class="form-control" x-model="reportConfig.dateFrom">
                                    </div>
                                    <div class="col-6">
                                        <input type="date" class="form-control" x-model="reportConfig.dateTo">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">„Éá„Éº„Çø„Ç´„ÉÜ„Ç¥„É™</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="reportConfig.dataSources" value="sales">
                                    <label class="form-check-label">Â£≤‰∏ä„Éá„Éº„Çø</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="reportConfig.dataSources" value="projects">
                                    <label class="form-check-label">Ê°à‰ª∂„Éá„Éº„Çø</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="reportConfig.dataSources" value="engineers">
                                    <label class="form-check-label">ÊäÄË°ìËÄÖ„Éá„Éº„Çø</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="reportConfig.dataSources" value="matching">
                                    <label class="form-check-label">„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Éá„Éº„Çø</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Éë„É¨„ÉÉ„Éà -->
                        <div class="form-section">
                            <div class="section-title">
                                <i class="bi bi-puzzle"></i>„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà
                            </div>
                            <div class="component-palette">
                                <div class="component-item" draggable="true" @dragstart="startDrag($event, 'chart')">
                                    <i class="bi bi-bar-chart component-icon"></i>
                                    <div class="component-name">„Ç∞„É©„Éï</div>
                                </div>
                                <div class="component-item" draggable="true" @dragstart="startDrag($event, 'table')">
                                    <i class="bi bi-table component-icon"></i>
                                    <div class="component-name">„ÉÜ„Éº„Éñ„É´</div>
                                </div>
                                <div class="component-item" draggable="true" @dragstart="startDrag($event, 'metric')">
                                    <i class="bi bi-speedometer2 component-icon"></i>
                                    <div class="component-name">„É°„Éà„É™„ÇØ„Çπ</div>
                                </div>
                                <div class="component-item" draggable="true" @dragstart="startDrag($event, 'text')">
                                    <i class="bi bi-textarea-t component-icon"></i>
                                    <div class="component-name">„ÉÜ„Ç≠„Çπ„Éà</div>
                                </div>
                                <div class="component-item" draggable="true" @dragstart="startDrag($event, 'image')">
                                    <i class="bi bi-image component-icon"></i>
                                    <div class="component-name">ÁîªÂÉè</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‰∏≠Â§Æ„Éë„Éç„É´: „Ç≠„É£„É≥„Éê„Çπ -->
                <div class="builder-panel">
                    <div class="panel-header">
                        <div class="d-flex justify-content-between align-items-center w-100">
                            <div>
                                <i class="bi bi-layout-text-window me-2"></i>„É¨„Éù„Éº„Éà„Ç≠„É£„É≥„Éê„Çπ
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm" @click="clearCanvas()">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <button class="btn btn-outline-primary btn-sm" @click="previewReport()">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="canvas-area" 
                             @drop="dropComponent($event)" 
                             @dragover.prevent 
                             @dragenter.prevent>
                            
                            <!-- Á©∫„ÅÆÁä∂ÊÖã -->
                            <div class="canvas-empty" x-show="reportSections.length === 0">
                                <i class="bi bi-plus-circle"></i>
                                <h5>„É¨„Éù„Éº„Éà„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜ</h5>
                                <p>Â∑¶ÂÅ¥„Åã„Çâ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åó„Å¶<br>„É¨„Éù„Éº„Éà„ÇíÊßãÁØâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                            
                            <!-- „É¨„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
                            <div class="report-sections" id="sortable-sections" x-show="reportSections.length > 0">
                                <template x-for="(section, index) in reportSections" :key="section.id">
                                    <div class="report-section" :data-id="section.id" @click="selectSection(section.id)">
                                        <div class="section-header">
                                            <div class="d-flex align-items-center gap-2">
                                                <i class="bi bi-grip-vertical drag-handle"></i>
                                                <span class="section-type" x-text="getSectionTypeName(section.type)"></span>
                                                <span x-text="section.title || '„Çø„Ç§„Éà„É´Êú™Ë®≠ÂÆö'"></span>
                                            </div>
                                            <div class="section-actions">
                                                <button class="btn btn-outline-secondary btn-sm" @click="editSection(section.id)">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-outline-danger btn-sm" @click="removeSection(index)">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="section-content">
                                            <!-- „Ç∞„É©„Éï„Éó„É¨„Éì„É•„Éº -->
                                            <div x-show="section.type === 'chart'" class="chart-preview">
                                                <canvas :id="'preview-chart-' + section.id" style="max-height: 200px;"></canvas>
                                            </div>
                                            
                                            <!-- „ÉÜ„Éº„Éñ„É´„Éó„É¨„Éì„É•„Éº -->
                                            <div x-show="section.type === 'table'">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>È†ÖÁõÆ</th>
                                                            <th>ÂÄ§</th>
                                                            <th>ÂâçÊúàÊØî</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>„Çµ„É≥„Éó„É´„Éá„Éº„Çø1</td>
                                                            <td>1,000</td>
                                                            <td>+5.2%</td>
                                                        </tr>
                                                        <tr>
                                                            <td>„Çµ„É≥„Éó„É´„Éá„Éº„Çø2</td>
                                                            <td>2,500</td>
                                                            <td>-2.1%</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            <!-- „É°„Éà„É™„ÇØ„Çπ„Éó„É¨„Éì„É•„Éº -->
                                            <div x-show="section.type === 'metric'" class="row text-center">
                                                <div class="col-4">
                                                    <h4 class="text-primary">1,234</h4>
                                                    <small>Â£≤‰∏äÈ´ò</small>
                                                </div>
                                                <div class="col-4">
                                                    <h4 class="text-success">+12%</h4>
                                                    <small>ÊàêÈï∑Áéá</small>
                                                </div>
                                                <div class="col-4">
                                                    <h4 class="text-info">98.5%</h4>
                                                    <small>ÈÅîÊàêÁéá</small>
                                                </div>
                                            </div>
                                            
                                            <!-- „ÉÜ„Ç≠„Çπ„Éà„Éó„É¨„Éì„É•„Éº -->
                                            <div x-show="section.type === 'text'">
                                                <p x-text="section.content || '„ÉÜ„Ç≠„Çπ„Éà„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇÁ∑®ÈõÜ„Åô„Çã„Å´„ÅØÂè≥„ÅÆË®≠ÂÆö„Éë„Éç„É´„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'"></p>
                                            </div>
                                            
                                            <!-- ÁîªÂÉè„Éó„É¨„Éì„É•„Éº -->
                                            <div x-show="section.type === 'image'" class="text-center">
                                                <i class="bi bi-image" style="font-size: 3rem; color: #ccc;"></i>
                                                <p class="mt-2 text-muted">ÁîªÂÉè„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Âè≥„Éë„Éç„É´: Ë®≠ÂÆö -->
                <div class="config-panel">
                    <div class="config-tabs">
                        <button class="config-tab" :class="{ active: activeConfigTab === 'section' }" @click="activeConfigTab = 'section'">
                            „Çª„ÇØ„Ç∑„Éß„É≥
                        </button>
                        <button class="config-tab" :class="{ active: activeConfigTab === 'schedule' }" @click="activeConfigTab = 'schedule'">
                            „Çπ„Ç±„Ç∏„É•„Éº„É´
                        </button>
                        <button class="config-tab" :class="{ active: activeConfigTab === 'share' }" @click="activeConfigTab = 'share'">
                            ÂÖ±Êúâ
                        </button>
                    </div>
                    
                    <div class="config-content">
                        
                        <!-- „Çª„ÇØ„Ç∑„Éß„É≥Ë®≠ÂÆö -->
                        <div x-show="activeConfigTab === 'section'">
                            <div x-show="selectedSection">
                                <h6 class="mb-3">„Çª„ÇØ„Ç∑„Éß„É≥Ë®≠ÂÆö</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">„Çø„Ç§„Éà„É´</label>
                                    <input type="text" class="form-control" x-model="currentSectionConfig.title" 
                                           placeholder="„Çª„ÇØ„Ç∑„Éß„É≥„Çø„Ç§„Éà„É´">
                                </div>
                                
                                <div x-show="currentSectionConfig.type === 'chart'">
                                    <div class="mb-3">
                                        <label class="form-label">„Ç∞„É©„Éï„Çø„Ç§„Éó</label>
                                        <select class="form-select" x-model="currentSectionConfig.chartType">
                                            <option value="line">Á∑ö„Ç∞„É©„Éï</option>
                                            <option value="bar">Ê£í„Ç∞„É©„Éï</option>
                                            <option value="pie">ÂÜÜ„Ç∞„É©„Éï</option>
                                            <option value="doughnut">„Éâ„Éº„Éä„ÉÑ„Ç∞„É©„Éï</option>
                                            <option value="area">„Ç®„É™„Ç¢„Ç∞„É©„Éï</option>
                                        </select>
                                    </div>
                                    
                                    <div class="data-mapping">
                                        <h6 class="mb-2">„Éá„Éº„Çø„Éû„ÉÉ„Éî„É≥„Ç∞</h6>
                                        <div class="mapping-row">
                                            <span class="mapping-label">XËª∏:</span>
                                            <select class="form-select form-select-sm">
                                                <option>Êúà</option>
                                                <option>Êó•‰ªò</option>
                                                <option>„Ç´„ÉÜ„Ç¥„É™</option>
                                            </select>
                                        </div>
                                        <div class="mapping-row">
                                            <span class="mapping-label">YËª∏:</span>
                                            <select class="form-select form-select-sm">
                                                <option>Â£≤‰∏äÈ´ò</option>
                                                <option>‰ª∂Êï∞</option>
                                                <option>Âà©ÁõäÁéá</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">„Ç´„É©„Éº„ÉÜ„Éº„Éû</label>
                                        <div class="d-flex gap-2">
                                            <div class="color-picker" style="background: #0d6efd;" @click="setChartColor('#0d6efd')"></div>
                                            <div class="color-picker" style="background: #198754;" @click="setChartColor('#198754')"></div>
                                            <div class="color-picker" style="background: #dc3545;" @click="setChartColor('#dc3545')"></div>
                                            <div class="color-picker" style="background: #ffc107;" @click="setChartColor('#ffc107')"></div>
                                            <div class="color-picker" style="background: #6f42c1;" @click="setChartColor('#6f42c1')"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div x-show="currentSectionConfig.type === 'text'">
                                    <div class="mb-3">
                                        <label class="form-label">ÂÜÖÂÆπ</label>
                                        <textarea class="form-control" rows="6" x-model="currentSectionConfig.content"
                                                 placeholder="„ÉÜ„Ç≠„Çπ„ÉàÂÜÖÂÆπ„ÇíÂÖ•Âäõ"></textarea>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" x-model="currentSectionConfig.showTitle">
                                        <label class="form-check-label">„Çø„Ç§„Éà„É´„ÇíË°®Á§∫</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" x-model="currentSectionConfig.showBorder">
                                        <label class="form-check-label">Â¢ÉÁïåÁ∑ö„ÇíË°®Á§∫</label>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary btn-sm w-100" @click="applySectionConfig()">
                                    Ë®≠ÂÆö„ÇíÈÅ©Áî®
                                </button>
                            </div>
                            
                            <div x-show="!selectedSection" class="text-center text-muted py-4">
                                <i class="bi bi-arrow-left" style="font-size: 2rem;"></i>
                                <p class="mt-2">„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                            </div>
                        </div>
                        
                        <!-- „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆö -->
                        <div x-show="activeConfigTab === 'schedule'">
                            <h6 class="mb-3">Ëá™ÂãïÁîüÊàê„Çπ„Ç±„Ç∏„É•„Éº„É´</h6>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="scheduleConfig.enabled">
                                    <label class="form-check-label">Ëá™ÂãïÁîüÊàê„ÇíÊúâÂäπ„Å´„Åô„Çã</label>
                                </div>
                            </div>
                            
                            <div x-show="scheduleConfig.enabled">
                                <div class="schedule-grid">
                                    <div>
                                        <label class="form-label">È†ªÂ∫¶</label>
                                        <select class="form-select" x-model="scheduleConfig.frequency">
                                            <option value="daily">ÊØéÊó•</option>
                                            <option value="weekly">ÊØéÈÄ±</option>
                                            <option value="monthly">ÊØéÊúà</option>
                                            <option value="quarterly">ÂõõÂçäÊúü</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label">ÂÆüË°åÊôÇÂàª</label>
                                        <div class="time-picker">
                                            <input type="time" class="form-control" x-model="scheduleConfig.time">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3" x-show="scheduleConfig.frequency === 'weekly'">
                                    <label class="form-label">ÊõúÊó•</label>
                                    <select class="form-select" x-model="scheduleConfig.dayOfWeek">
                                        <option value="1">ÊúàÊõúÊó•</option>
                                        <option value="2">ÁÅ´ÊõúÊó•</option>
                                        <option value="3">Ê∞¥ÊõúÊó•</option>
                                        <option value="4">Êú®ÊõúÊó•</option>
                                        <option value="5">ÈáëÊõúÊó•</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3" x-show="scheduleConfig.frequency === 'monthly'">
                                    <label class="form-label">ÂÆüË°åÊó•</label>
                                    <select class="form-select" x-model="scheduleConfig.dayOfMonth">
                                        <option value="1">1Êó•</option>
                                        <option value="5">5Êó•</option>
                                        <option value="10">10Êó•</option>
                                        <option value="15">15Êó•</option>
                                        <option value="last">ÊúàÊú´</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÂÖ±ÊúâË®≠ÂÆö -->
                        <div x-show="activeConfigTab === 'share'">
                            <h6 class="mb-3">ÈÖç‰ø°„ÉªÂÖ±ÊúâË®≠ÂÆö</h6>
                            
                            <div class="mb-3">
                                <label class="form-label">ÈÖç‰ø°ÂÖà„ÇíËøΩÂä†</label>
                                <div class="input-group">
                                    <input type="email" class="form-control" x-model="newRecipient" 
                                           placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ">
                                    <button class="btn btn-outline-primary" @click="addRecipient()">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="recipients-list">
                                <template x-for="(recipient, index) in recipients" :key="index">
                                    <div class="recipient-item">
                                        <span x-text="recipient"></span>
                                        <button class="btn btn-outline-danger btn-sm" @click="removeRecipient(index)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </template>
                                
                                <div x-show="recipients.length === 0" class="text-center text-muted py-3">
                                    ÈÖç‰ø°ÂÖà„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                                </div>
                            </div>
                            
                            <div class="mb-3 mt-3">
                                <label class="form-label">Âá∫ÂäõÂΩ¢Âºè</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="shareConfig.formats" value="pdf">
                                    <label class="form-check-label">PDF</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="shareConfig.formats" value="excel">
                                    <label class="form-check-label">Excel</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" x-model="shareConfig.formats" value="csv">
                                    <label class="form-check-label">CSV</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
                    <div class="action-buttons">
                        <button class="btn btn-outline-secondary flex-fill" @click="saveDraft()">
                            <i class="bi bi-save me-1"></i>‰∏ãÊõ∏„Åç‰øùÂ≠ò
                        </button>
                        <button class="btn btn-success flex-fill" @click="saveTemplate()">
                            <i class="bi bi-check-circle me-1"></i>‰øùÂ≠ò
                        </button>
                        <button class="btn btn-primary flex-fill" @click="generateReport()">
                            <i class="bi bi-play-circle me-1"></i>ÁîüÊàê
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- „Éó„É¨„Éì„É•„Éº„É¢„Éº„ÉÄ„É´ -->
    <div class="preview-overlay" x-show="showPreview" @click="showPreview = false" x-transition.opacity></div>
    <div class="floating-preview" x-show="showPreview" x-transition>
        <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
            <h5 class="mb-0">„É¨„Éù„Éº„Éà„Éó„É¨„Éì„É•„Éº</h5>
            <button class="btn btn-outline-secondary" @click="showPreview = false">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <div class="p-3" style="height: calc(90vh - 80px); overflow-y: auto;">
            <!-- „Éó„É¨„Éì„É•„Éº„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            <div class="text-center py-5">
                <i class="bi bi-file-earmark-text" style="font-size: 4rem; color: #ccc;"></i>
                <h4 class="mt-3">„É¨„Éù„Éº„Éà„Éó„É¨„Éì„É•„Éº</h4>
                <p class="text-muted">Ë®≠ÂÆö„Åï„Çå„Åü„É¨„Éù„Éº„Éà„ÅÆÂÆåÊàê„Ç§„É°„Éº„Ç∏„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('customReportBuilder', () => ({
                // „É¨„Éù„Éº„ÉàË®≠ÂÆö
                reportConfig: {
                    name: '',
                    description: '',
                    type: 'monthly',
                    category: 'sales',
                    dateFrom: '',
                    dateTo: '',
                    dataSources: []
                },
                
                // „É¨„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥
                reportSections: [],
                selectedSection: null,
                currentSectionConfig: {},
                
                // UIÁä∂ÊÖã
                activeConfigTab: 'section',
                showPreview: false,
                autoSaved: false,
                lastSaved: 'Êú™‰øùÂ≠ò',
                validationErrors: [],
                
                // „Çπ„Ç±„Ç∏„É•„Éº„É´Ë®≠ÂÆö
                scheduleConfig: {
                    enabled: false,
                    frequency: 'monthly',
                    time: '09:00',
                    dayOfWeek: '1',
                    dayOfMonth: '1'
                },
                
                // ÂÖ±ÊúâË®≠ÂÆö
                shareConfig: {
                    formats: ['pdf']
                },
                recipients: [],
                newRecipient: '',
                
                // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó
                draggedComponent: null,
                
                init() {
                    this.initSortable();
                    this.startAutoSave();
                    this.setDefaultDates();
                },
                
                setDefaultDates() {
                    const today = new Date();
                    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                    const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                    
                    this.reportConfig.dateFrom = firstDay.toISOString().split('T')[0];
                    this.reportConfig.dateTo = lastDay.toISOString().split('T')[0];
                },
                
                initSortable() {
                    this.$nextTick(() => {
                        const sortableElement = document.getElementById('sortable-sections');
                        if (sortableElement) {
                            Sortable.create(sortableElement, {
                                handle: '.drag-handle',
                                animation: 150,
                                ghostClass: 'sortable-ghost',
                                chosenClass: 'sortable-chosen',
                                onEnd: (evt) => {
                                    const item = this.reportSections[evt.oldIndex];
                                    this.reportSections.splice(evt.oldIndex, 1);
                                    this.reportSections.splice(evt.newIndex, 0, item);
                                }
                            });
                        }
                    });
                },
                
                startAutoSave() {
                    setInterval(() => {
                        if (this.reportSections.length > 0 || this.reportConfig.name) {
                            this.autoSave();
                        }
                    }, 30000); // 30ÁßíÈñìÈöî
                },
                
                autoSave() {
                    console.log('Ëá™Âãï‰øùÂ≠òÂÆüË°å');
                    this.autoSaved = true;
                    this.lastSaved = new Date().toLocaleTimeString('ja-JP', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    setTimeout(() => {
                        this.autoSaved = false;
                    }, 3000);
                },
                
                // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó
                startDrag(event, componentType) {
                    this.draggedComponent = componentType;
                    event.dataTransfer.effectAllowed = 'copy';
                },
                
                dropComponent(event) {
                    event.preventDefault();
                    if (this.draggedComponent) {
                        this.addSection(this.draggedComponent);
                        this.draggedComponent = null;
                    }
                },
                
                addSection(type) {
                    const newSection = {
                        id: 'section_' + Date.now(),
                        type: type,
                        title: this.getDefaultTitle(type),
                        content: '',
                        chartType: 'line',
                        showTitle: true,
                        showBorder: true,
                        order: this.reportSections.length
                    };
                    
                    this.reportSections.push(newSection);
                    this.selectSection(newSection.id);
                    this.initSortable(); // ÂÜçÂàùÊúüÂåñ
                    
                    // „Ç∞„É©„Éï„ÅÆÂ†¥Âêà„ÅØ„Éó„É¨„Éì„É•„Éº„Çí‰ΩúÊàê
                    if (type === 'chart') {
                        this.$nextTick(() => {
                            this.createChartPreview(newSection.id);
                        });
                    }
                },
                
                getDefaultTitle(type) {
                    const titles = {
                        chart: 'Â£≤‰∏äÊé®Áßª„Ç∞„É©„Éï',
                        table: '„Éá„Éº„Çø„ÉÜ„Éº„Éñ„É´',
                        metric: 'KPIÊåáÊ®ô',
                        text: '„ÉÜ„Ç≠„Çπ„Éà„Çª„ÇØ„Ç∑„Éß„É≥',
                        image: 'ÁîªÂÉè„Çª„ÇØ„Ç∑„Éß„É≥'
                    };
                    return titles[type] || '„Çª„ÇØ„Ç∑„Éß„É≥';
                },
                
                getSectionTypeName(type) {
                    const names = {
                        chart: '„Ç∞„É©„Éï',
                        table: '„ÉÜ„Éº„Éñ„É´',
                        metric: '„É°„Éà„É™„ÇØ„Çπ',
                        text: '„ÉÜ„Ç≠„Çπ„Éà',
                        image: 'ÁîªÂÉè'
                    };
                    return names[type] || type;
                },
                
                selectSection(sectionId) {
                    this.selectedSection = sectionId;
                    const section = this.reportSections.find(s => s.id === sectionId);
                    if (section) {
                        this.currentSectionConfig = { ...section };
                        this.activeConfigTab = 'section';
                    }
                },
                
                editSection(sectionId) {
                    this.selectSection(sectionId);
                },
                
                removeSection(index) {
                    if (confirm('„Åì„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                        this.reportSections.splice(index, 1);
                        this.selectedSection = null;
                        this.currentSectionConfig = {};
                    }
                },
                
                applySectionConfig() {
                    const sectionIndex = this.reportSections.findIndex(s => s.id === this.selectedSection);
                    if (sectionIndex !== -1) {
                        this.reportSections[sectionIndex] = { ...this.currentSectionConfig };
                        
                        // „Ç∞„É©„Éï„ÅÆÂ†¥Âêà„ÅØ„Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
                        if (this.currentSectionConfig.type === 'chart') {
                            this.$nextTick(() => {
                                this.createChartPreview(this.selectedSection);
                            });
                        }
                    }
                },
                
                createChartPreview(sectionId) {
                    const ctx = document.getElementById(`preview-chart-${sectionId}`);
                    if (!ctx) return;
                    
                    const section = this.reportSections.find(s => s.id === sectionId);
                    if (!section) return;
                    
                    // Êó¢Â≠ò„ÅÆ„ÉÅ„É£„Éº„Éà„Åå„ÅÇ„Çå„Å∞Á†¥Ê£Ñ
                    if (ctx.chart) {
                        ctx.chart.destroy();
                    }
                    
                    const chartType = section.chartType || 'line';
                    const sampleData = this.generateSampleData(chartType);
                    
                    ctx.chart = new Chart(ctx, {
                        type: chartType,
                        data: sampleData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: chartType !== 'pie' && chartType !== 'doughnut'
                                }
                            },
                            scales: chartType === 'pie' || chartType === 'doughnut' ? {} : {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                },
                
                generateSampleData(chartType) {
                    const labels = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'];
                    const colors = ['#0d6efd', '#198754', '#dc3545', '#ffc107', '#6f42c1', '#20c997'];
                    
                    if (chartType === 'pie' || chartType === 'doughnut') {
                        return {
                            labels: ['WebÈñãÁô∫', '„É¢„Éê„Ç§„É´', 'AI/ML', '„Ç§„É≥„Éï„É©'],
                            datasets: [{
                                data: [40, 25, 20, 15],
                                backgroundColor: colors.slice(0, 4)
                            }]
                        };
                    }
                    
                    return {
                        labels: labels,
                        datasets: [{
                            label: '„Çµ„É≥„Éó„É´„Éá„Éº„Çø',
                            data: [65, 72, 68, 75, 80, 85],
                            borderColor: colors[0],
                            backgroundColor: chartType === 'line' ? 'transparent' : colors[0],
                            tension: 0.4,
                            fill: chartType === 'area'
                        }]
                    };
                },
                
                setChartColor(color) {
                    this.currentSectionConfig.color = color;
                },
                
                clearCanvas() {
                    if (confirm('„Åô„Åπ„Å¶„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                        this.reportSections = [];
                        this.selectedSection = null;
                        this.currentSectionConfig = {};
                    }
                },
                
                previewReport() {
                    this.showPreview = true;
                },
                
                // ÈÖç‰ø°ÂÖàÁÆ°ÁêÜ
                addRecipient() {
                    if (this.newRecipient && this.isValidEmail(this.newRecipient)) {
                        if (!this.recipients.includes(this.newRecipient)) {
                            this.recipients.push(this.newRecipient);
                            this.newRecipient = '';
                        }
                    }
                },
                
                removeRecipient(index) {
                    this.recipients.splice(index, 1);
                },
                
                isValidEmail(email) {
                    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
                },
                
                // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                validateReport() {
                    this.validationErrors = [];
                    
                    if (!this.reportConfig.name) {
                        this.validationErrors.push('„É¨„Éù„Éº„ÉàÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    }
                    
                    if (this.reportSections.length === 0) {
                        this.validationErrors.push('Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    }
                    
                    if (this.reportConfig.dataSources.length === 0) {
                        this.validationErrors.push('„Éá„Éº„Çø„ÇΩ„Éº„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    }
                    
                    return this.validationErrors.length === 0;
                },
                
                // „Ç¢„ÇØ„Ç∑„Éß„É≥
                saveDraft() {
                    console.log('‰∏ãÊõ∏„Åç‰øùÂ≠ò');
                    this.autoSave();
                },
                
                saveTemplate() {
                    if (this.validateReport()) {
                        console.log('„ÉÜ„É≥„Éó„É¨„Éº„Éà‰øùÂ≠ò:', {
                            config: this.reportConfig,
                            sections: this.reportSections,
                            schedule: this.scheduleConfig,
                            recipients: this.recipients
                        });
                        alert('„É¨„Éù„Éº„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                    }
                },
                
                generateReport() {
                    if (this.validateReport()) {
                        console.log('„É¨„Éù„Éº„ÉàÁîüÊàêÈñãÂßã');
                        alert('„É¨„Éù„Éº„Éà„ÅÆÁîüÊàê„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü„ÄÇÂÆå‰∫ÜÊôÇ„Å´ÈÄöÁü•„Åï„Çå„Åæ„Åô„ÄÇ');
                    }
                }
            }));
        });
    </script>
</body>
</html>