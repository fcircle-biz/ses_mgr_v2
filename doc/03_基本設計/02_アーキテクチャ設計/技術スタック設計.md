# SES業務システム 技術スタック設計

## 1. システム構成概要

### アーキテクチャパターン
- **初期**: モノリスファースト（単一Spring Bootアプリケーション）
- **将来**: マイクロサービス化への移行を考慮したAPI設計

### デプロイメント環境
- **コンテナ化**: Docker + Docker Compose
- **クラウド**: AWS/GCP/Azure対応
- **CI/CD**: GitHub Actions

## 2. 技術スタック詳細

### 2.1 バックエンド

#### コア技術
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Java** | 17 LTS | メイン言語 | 長期サポート、安定性、企業システム実績 |
| **Spring Boot** | 3.2.x | アプリケーションフレームワーク | 豊富なエコシステム、DI、自動設定 |
| **Spring Security** | 6.2.x | セキュリティ | OAuth2/OIDC対応、Keycloak連携 |
| **Spring Data JPA** | 3.2.x | データアクセス | ORM、リポジトリパターン |
| **Hibernate** | 6.4.x | ORM | JPA実装、データベース抽象化 |

#### 認証・認可
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Keycloak** | 22.x | 認証基盤 | エンタープライズ対応、OAuth2/OIDC、ロール管理 |
| **Spring Security OAuth2** | 6.2.x | OAuth2クライアント | Keycloak連携、JWT トークン処理 |

#### データベース
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **PostgreSQL** | 15.x | メインDB | ACID準拠、JSON対応、高性能 |
| **Redis** | 7.x | セッション・キャッシュ | セッション管理、API結果キャッシュ |
| **Flyway** | 9.x | DBマイグレーション | バージョン管理、本番運用安全性 |

#### API・通信
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Spring Web MVC** | 6.1.x | REST API | RESTful API、JSONレスポンス |
| **OpenAPI 3** | 3.0.3 | API仕様書 | 自動生成、フロントエンド連携 |
| **Jackson** | 2.15.x | JSON処理 | Spring Boot標準、高性能 |

### 2.2 フロントエンド

#### テンプレートエンジン
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Thymeleaf** | 3.1.x | サーバーサイドレンダリング | Spring Boot統合、SEO対応 |
| **Bootstrap** | 5.3.x | CSSフレームワーク | レスポンシブ、豊富なコンポーネント |

#### JavaScript
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Alpine.js** | 3.x | 軽量フロントエンド | Thymeleafとの親和性、学習コスト低 |
| **Chart.js** | 4.x | グラフ・チャート | ダッシュボード、レポート可視化 |
| **htmx** | 1.9.x | 動的UI | Ajax、部分更新、SPA風UI |

### 2.3 インフラストラクチャ

#### コンテナ・オーケストレーション
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Docker** | 24.x | コンテナ化 | 環境統一、デプロイメント簡素化 |
| **Docker Compose** | 2.x | 開発環境 | ローカル開発、マルチコンテナ管理 |

#### 監視・ログ
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Spring Boot Actuator** | 3.2.x | ヘルスチェック・メトリクス | アプリケーション監視 |
| **Micrometer** | 1.12.x | メトリクス収集 | Prometheus連携 |
| **Logback** | 1.4.x | ログ管理 | 構造化ログ、ログレベル制御 |

### 2.4 テスト

#### テストフレームワーク
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **JUnit 5** | 5.10.x | 単体テスト | 標準テストフレームワーク |
| **Mockito** | 5.x | モックテスト | 依存関係モック化 |
| **Testcontainers** | 1.19.x | 統合テスト | 実際のDBでのテスト |
| **Spring Boot Test** | 3.2.x | 統合テスト | コンテキスト込みテスト |

### 2.5 ビルド・CI/CD

#### ビルドツール
| 技術 | バージョン | 用途 | 理由 |
|------|------------|------|------|
| **Maven** | 3.9.x | ビルド管理 | 依存関係管理、標準的 |
| **GitHub Actions** | - | CI/CD | GitHub統合、無料枠 |

## 3. 外部システム連携

### 3.1 会計システム連携
| システム | 連携方式 | 用途 |
|----------|----------|------|
| **マネーフォワード クラウド会計** | REST API | 請求・支払仕訳連携、会計データ連携 |

### 3.2 通知システム
| システム | 連携方式 | 用途 |
|----------|----------|------|
| **Slack** | Webhook/Bot API | 通知・承認依頼 |
| **メール** | SMTP/SendGrid | システム通知 |

### 3.3 電子契約
| システム | 連携方式 | 用途 |
|----------|----------|------|
| **CloudSign** | REST API | 契約書電子署名 |

## 4. データベース設計方針

### 4.1 スキーマ戦略
- **マルチテナント**: 単一DB、tenant_id による論理分離
- **正規化**: 第3正規形まで適用
- **監査ログ**: created_at, updated_at, created_by, updated_by

### 4.2 命名規則
- **テーブル**: スネークケース（例: `user_accounts`）
- **カラム**: スネークケース（例: `created_at`）
- **インデックス**: `idx_テーブル名_カラム名`

## 5. セキュリティ要件

### 5.1 認証・認可
- **OIDC**: Keycloak による認証
- **JWT**: アクセストークン、リフレッシュトークン
- **RBAC**: ロールベースアクセス制御

### 5.2 データ保護
- **暗号化**: DB暗号化（AES-256）、通信暗号化（TLS 1.3）
- **監査ログ**: 全操作の追跡可能性
- **データマスキング**: 開発環境での個人情報保護

## 6. 開発環境構成

### 6.1 ローカル開発
```yaml
services:
  app:
    build: .
    ports:
      - "8080:8080"
  
  postgres:
    image: postgres:15
    ports:
      - "5432:5432"
  
  redis:
    image: redis:7
    ports:
      - "6379:6379"
  
  keycloak:
    image: quay.io/keycloak/keycloak:22
    ports:
      - "8081:8080"
```

### 6.2 本番環境
- **コンテナオーケストレーション**: Kubernetes or Docker Swarm
- **負荷分散**: Nginx or AWS ALB
- **データベース**: マネージドサービス（AWS RDS, GCP CloudSQL）

## 7. 段階的実装戦略

### Phase 1: MVP（4-6週間）
- Spring Boot基盤
- Keycloak認証連携
- 基本CRUD（案件・技術者）
- PostgreSQL セットアップ

### Phase 2: 業務機能（6-8週間）
- マッチング機能
- 勤怠管理
- 基本ワークフロー

### Phase 3: 高度機能（8-10週間）
- 請求・支払
- レポート・ダッシュボード
- 外部システム連携

---

**作成者**: システム化プロジェクトチーム